<div id="session-header">
	<div id="info">
		<div id="img-stats">
			<a id="img" href="" onclick="$('#image-edit-file').click()">
				<img ng-src="{{session.image}}" width="150" height="150" />
			</a>
			<div ng-switch="session.state">
				<div id="time-left" ng-switch-when="running">
					<i class="fa fa-clock-o"></i> Ends {{session.end_time | countdown}}
				</div>
				<div id="time-left" ng-switch-when="before">
					Starts {{session.start_time | countdown}}
				</div>
				<div id="time-left" ng-switch-when="after">
					Ended {{session.end_time | countdown}}
				</div>
			</div>
			<div id="viewers" ng-if="session.state == 'running'">
				{{session.num_viewers}} currently viewing
			</div>
			<div id="views" ng-if="session.state != 'running'">
				<ng-pluralize count="session.views"
				when="{'one': '1 view',
				'other': '{} views'}">
				</ng-pluralize>
			</div>
			<a id="twitter-name" href="//twitter.com/{{session.twitter}}" ng-if="session.twitter" target="_blank">
				@{{session.twitter}}
			</a>
		</div>
		<div id="title-desc">
			<h2><span ng-show="state.edit != 'title'" ng-click="!state.owner || (state.edit='title')">{{session.title}}</span><input id="edit-title" ng-model="session.title" ng-show="state.edit == 'title'" focus-on-show ng-blur="edit('title', session.title)"/><span id="live" ng-if="session.state == 'running'">&nbsp;[LIVE]</span></h2>
			<textarea ng-model="session.desc" ng-show="state.edit == 'desc'" focus-on-show ng-blur="edit('desc', session.desc)"></textarea>
			<div id="desc" ng-bind-html="session.desc | markdown"></div>
			<a href="" ng-if="state.owner" ng-show="state.edit != 'desc'" ng-click="!state.owner || (state.edit = 'desc')" ng-show="state.edit != 'desc'">
				<i class="fa fa-pencil"></i> Edit
			</a>
		</div>
	</div>
</div>
<div id="session-ask" ng-if="session.state != 'after' && tab !='question' && !owner">
	<div id="ask-box">
		<h2>Ask {{session.name}}:</h2>
		<textarea ng-model="state.question" maxlength="1000"></textarea>
		<span ng-if="state.question && state.question.length < 6">{{6 - state.question.length}} characters to go...</span>
		<span ng-if="state.question && state.question.length >= 6">{{1000 - state.question.length}} characters to go...</span>
		<a id="ask-btn" class="clickable" ng-click="ask()" ng-disabled="state.question.length < 6 || state.question.length > 500">ASK!</a>
	</div>
</div>
<div id="questions-area">
	<div id="questions">
		<div id="filter">
			<div id="text">
				<a class="filter-options" ng-if="tab == 'question'" ng-href="/s/{{sessionId}}">Return to session </a>
				<span ng-if="tab != 'question'">
				<a class="filter-options" ng-class="{current: tab == 'unanswered'}" ng-href="/s/{{sessionId}}/unanswered"> Unanswered </a> | 
				<a class="filter-options" ng-class="{current: tab == 'answered'}" ng-href="/s/{{sessionId}}/answered"> Answered </a>|
				<a class="filter-options" ng-class="{current: tab == 'starred'}" ng-href="/s/{{sessionId}}/starred"> Starred</a></span>
			</div>
		</div>
		<div id="no-questions" ng-if="!session.questions.length">
			There is nothing here. Be the first to ask a question!
		</div>
		<div class="question-wrapper">
			<div class="pair" ng-repeat="question in session.questions | filter:qfilter | orderBy:'-score'" ng-click="state.drafts[state.answering || -1] = state.answerdraft;state.answering = state.owner && question.id; state.answerdraft = state.drafts[question.id] || question.answer.response || ''">
				<div id="vote">
					<a class="clickable" ng-click="vote(question, 1); $event.stopPropagation()" ng-class="{upvote: question.vote == 1}">&#x25B2;</a><br/>
					<a class="clickable" ng-click="vote(question, -1); $event.stopPropagation()" ng-class="{downvote: question.vote == -1}">&#x25BC;</a>
				</div>
				<div id="question">
					<div class="user-picture-left">
						<a ng-href="/u/{{question.asker.username}}" target="_self">
							<img class="circular" ng-src="{{question.asker.image}}" width="75" height="75" />
						</a>
					</div>
					<div id="main">
						<div id="top-row">
							<a id="user-name" ng-href="/u/{{question.asker.username}}" target="_self">{{question.asker.display}}</a>
							<div id="timestamp">{{question.created | countdown}}</div>
							<a class="clickable" ng-if="state.owner && session.state == 'running'">
								<i class="fa fa-comment"></i>&nbsp;reply
							</a>
							<a class="clickable" ng-if="state.owner && question.starred" ng-click="star(question, false); $event.stopPropagation()">
								<i class="fa fa-star"></i>&nbsp;unstar
							</a>
							<a class="clickable" ng-if="state.owner && !question.starred" ng-click="star(question, true); $event.stopPropagation()">
								<i class="fa fa-star"></i>&nbsp;star
							</a>
							<a ng-href="/q/{{question.id}}">
								<i class="fa fa-external-link"></i>&nbsp;permalink
							</a>
							<div id="votes">
								<ng-pluralize count="question.score"
								when="{'0': '0 votes',
								'one': '1 vote',
								'other': '{} votes'}">
								</ng-pluralize>
							</div>
						</div>
						<br/>
						<div id="text" ng-bind-html="question.question | markdown">
						</div>
					</div>
				</div>
				<div id="response" ng-if="question.answered || state.answering == question.id">
					<div class="user-picture-right">
						<a ng-href="/u/{{session.owner.username}}" target="_self">
							<img class="circular" ng-src="{{question.target.image}}" width="75" height="75" />
						</a>
					</div>
					<div id="main">
						<div id="top-row">
							<a id="user-name" ng-href="/u/{{session.owner.username}}" target="_self">{{session.owner.display}}</a>
							<div id="timestamp" ng-if="question.answered">{{question.answer.created | countdown}}</div>
							<a class="clickable" ng-if="state.owner && question.answered" ng-click="answer(question, ''); $event.stopPropagation()">
								<i class="fa fa-trash-o"></i>&nbsp;delete
							</a>
						</div>
						<br/>
						<div id="text" ng-bind-html="question.answer.response | markdown" ng-if="state.answering != question.id">
						</div>
						<textarea ng-if="state.owner" ng-show="state.answering == question.id" ng-model="state.answerdraft" focus-on-show ng-click="$event.stopPropagation()"></textarea>
						<button ng-if="state.owner" ng-show="state.answering == question.id" ng-click="answer(question, state.answerdraft); $event.stopPropagation()">Answer</button>
						<button ng-click="state.drafts[question.id] = state.answerdraft;state.answering = false; $event.stopPropagation()" ng-if="state.owner" ng-show="state.answering == question.id">Cancel</button>
					</div>						
				</div>
				<div id="question" ng-if="tab == 'question' && state.user" ng-click="$event.stopPropagation()">
					<form id="main" ng-submit="postComment()">
						<textarea placeholder="Comment on this question..." ng-model="state.comment" maxlength="500" focus-on-show></textarea>
						<span ng-if="state.comment">{{500 - state.comment.length}} characters left.</span>
						<div class="comment-btn" type="submit">Post Comment</div>
						<div style="clear: both"></div>
					</form>
				</div>
				<div class="comment" ng-repeat="comment in comments" ng-click="$event.stopPropagation()">
					<div class="user-picture-left">
						<a ng-href="/u/{{comment.user.username}}" target="_self" ng-if="comment.user.image">
							<img class="circular" ng-src="{{comment.user.image}}" width="75" height="75" />
						</a>
					</div>
					<div id="main">
						<div id="top-row">
							<a id="user-name" ng-href="/u/{{comment.user.username}}" target="_self">{{comment.user.display}}</a>
							<div id="timestamp">{{comment.created | countdown}}</div>
						</div>
						<br/>
						<div id="text" ng-bind-html="comment.comment | markdown">
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
